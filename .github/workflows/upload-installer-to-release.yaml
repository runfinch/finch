name: Upload installer
on:
  workflow_dispatch: # Trigger this workflow from tag

permissions:
  id-token: write   # This is required for requesting the JWT

jobs:         
  upload-installers:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: configure aws credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          role-to-assume: ${{ secrets.ROLE }}
          role-session-name: download-installer-session
          aws-region: ${{ secrets.REGION }}
      - name: Download installers
        run: |
          aws s3 cp s3://${{ secrets.INSTALLER_PRIVATE_BUCKET_NAME }}/Finch-${GITHUB_REF_NAME}-aarch64.pkg Finch-${GITHUB_REF_NAME}-aarch64.pkg
          aws s3 cp s3://${{ secrets.INSTALLER_PRIVATE_BUCKET_NAME }}/Finch-${GITHUB_REF_NAME}-x86_64.pkg Finch-${GITHUB_REF_NAME}-x86_64.pkg
      - name: Upload installers to release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${GITHUB_REF_NAME}
          files: |
            Finch-${GITHUB_REF_NAME}-aarch64.pkg
            Finch-${GITHUB_REF_NAME}-x86_64.pkg
